{% extends 'base.html' %} {% block title %}Home{% endblock %} {% block content
    %}
    <h4 class="text-center">Welcome, {{current_user.name}} </h4>
    <div class="container mt-5">
      <div class="row">
        <div class="col-md-6 offset-md-3">
          <h2 class="text-center">To-Do List</h2>
          <ul class="list-group" id="task-list">
            {% for task in tasks %}
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              <div>
                <p
                  class="task-desc mb-1 {{ 'completed' if task.completed else '' }}"
                >
                  {{ task.content }}
                </p>
                <small class="text-muted"
                  >Due: {{ task.due_date.strftime('%Y-%m-%d') }}</small
                >
              </div>
              <div>
                <button
                  class="btn btn-sm btn-success complete-btn"
                  data-id="{{ task.id }}"
                >
                {{ 'Undo' if task.completed else 'Complete' }}
                </button>
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".complete-btn").forEach((button) => {
          button.addEventListener("click", function () {
            const taskId = this.getAttribute("data-id");
            const completed = this.innerText === "Complete";
    
            fetch('{{ url_for("toggle_complete_task") }}', {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ taskId: taskId, completed: completed }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status === "success") {
                  window.location.reload();
                }
              });
          });
        });
    
        document.querySelectorAll(".delete-btn").forEach((button) => {
          button.addEventListener("click", function () {
            const taskId = this.getAttribute("data-id");
    
            fetch('{{ url_for("delete_task") }}', {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ taskId: taskId }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status === "success") {
                  window.location.reload();
                }
              });
          });
        });
      });
    </script>
    
    {% endblock %}
    